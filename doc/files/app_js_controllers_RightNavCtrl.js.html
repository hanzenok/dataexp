<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app/js/controllers/RightNavCtrl.js - dataexp</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="../assets/css/logo.png" width="117" height="52">dataexp: app/js/controllers/RightNavCtrl.js</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div class="yui3-g">

        <div id="sidebar" class="yui3-u">
            <div id="modules" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Modules</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../modules/client.html">client</a>
                                <ul>
                                        <li><a href="../modules/client.html#Controllers">Controllers</a></li>
                                        <li><a href="../modules/client.html#Services">Services</a></li>
                                </ul>
                            </li>
                            <li><a href="../modules/server.html">server</a>
                                <ul>
                                        <li><a href="../modules/server.html#Connectors">Connectors</a></li>
                                        <li><a href="../modules/server.html#RestApi">RestApi</a></li>
                                </ul>
                            </li>
                    </ul>
                </div>
            </div>
            
            <div id="classes" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Classes</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../classes/ChartsCtrl.html">ChartsCtrl</a></li>
                            <li><a href="../classes/DeleteSource.html">DeleteSource</a></li>
                            <li><a href="../classes/DeleteZoneCtrl.html">DeleteZoneCtrl</a></li>
                            <li><a href="../classes/DialogCtrl.html">DialogCtrl</a></li>
                            <li><a href="../classes/FabCtrl.html">FabCtrl</a></li>
                            <li><a href="../classes/FieldsService.html">FieldsService</a></li>
                            <li><a href="../classes/FileConnector.html">FileConnector</a></li>
                            <li><a href="../classes/GetFields.html">GetFields</a></li>
                            <li><a href="../classes/GetSources.html">GetSources</a></li>
                            <li><a href="../classes/GetStores.html">GetStores</a></li>
                            <li><a href="../classes/GetTimseries.html">GetTimseries</a></li>
                            <li><a href="../classes/HideBtnCtrl.html">HideBtnCtrl</a></li>
                            <li><a href="../classes/LeftNavCtrl.html">LeftNavCtrl</a></li>
                            <li><a href="../classes/LoaderCtrl.html">LoaderCtrl</a></li>
                            <li><a href="../classes/main.html">main</a></li>
                            <li><a href="../classes/MongoConnector.html">MongoConnector</a></li>
                            <li><a href="../classes/MovableChartsCtrl.html">MovableChartsCtrl</a></li>
                            <li><a href="../classes/MysqlConnector.html">MysqlConnector</a></li>
                            <li><a href="../classes/PutSource.html">PutSource</a></li>
                            <li><a href="../classes/RightNavCtrl.html">RightNavCtrl</a></li>
                            <li><a href="../classes/routes.html">routes</a></li>
                            <li><a href="../classes/server.html">server</a></li>
                            <li><a href="../classes/ToolBarCtrl.html">ToolBarCtrl</a></li>
                    </ul>
                </div>
            </div>
            
            
            
            
            
            <div id="fileTree" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Files</h2>
                </div>
                <div class="bd">
                    <ul><li>app/<ul><li>js/<ul><li><a href="../files/app_js_canvasjs.js.html">canvasjs.js</a></li><li>controllers/<ul><li><a href="../files/app_js_controllers_ChartsCtrl.js.html">ChartsCtrl.js</a></li><li><a href="../files/app_js_controllers_DeleteZoneCtrl.js.html">DeleteZoneCtrl.js</a></li><li><a href="../files/app_js_controllers_DialogCtrl.js.html">DialogCtrl.js</a></li><li><a href="../files/app_js_controllers_FabCtrl.js.html">FabCtrl.js</a></li><li><a href="../files/app_js_controllers_HideBtnCtrl.js.html">HideBtnCtrl.js</a></li><li><a href="../files/app_js_controllers_LeftNavCtrl.js.html">LeftNavCtrl.js</a></li><li><a href="../files/app_js_controllers_LoaderCtrl.js.html">LoaderCtrl.js</a></li><li><a href="../files/app_js_controllers_MovableChartsCtrl.js.html">MovableChartsCtrl.js</a></li><li><a href="../files/app_js_controllers_RightNavCtrl.js.html">RightNavCtrl.js</a></li><li><a href="../files/app_js_controllers_ToolBarCtrl.js.html">ToolBarCtrl.js</a></li></ul></li><li><a href="../files/app_js_main.js.html">main.js</a></li><li>services/<ul><li><a href="../files/app_js_services_FieldsService.js.html">FieldsService.js</a></li></ul></li></ul></li></ul></li><li>server.js/<ul></ul></li><li>server/<ul><li>connectors/<ul><li><a href="../files/server_connectors_FileConnector.js.html">FileConnector.js</a></li><li><a href="../files/server_connectors_MongoConnector.js.html">MongoConnector.js</a></li><li><a href="../files/server_connectors_MysqlConnector.js.html">MysqlConnector.js</a></li></ul></li><li>rest/<ul><li><a href="../files/server_rest_DeleteSource.js.html">DeleteSource.js</a></li><li><a href="../files/server_rest_GetFields.js.html">GetFields.js</a></li><li><a href="../files/server_rest_GetSources.js.html">GetSources.js</a></li><li><a href="../files/server_rest_GetStores.js.html">GetStores.js</a></li><li><a href="../files/server_rest_GetTimeseries.js.html">GetTimeseries.js</a></li><li><a href="../files/server_rest_PutSource.js.html">PutSource.js</a></li></ul></li><li><a href="../files/server_routes.js.html">routes.js</a></li></ul></li></ul>
                </div>
            </div>
            
        </div>

        <div id="main" class="yui3-u">
            <div class="content"><h4>app/js/controllers/RightNavCtrl.js</h4>

<pre class="code prettyprint linenums">
/**
 * Angualr.js controllers.
 * @module client
 * @submodule Controllers
 */

/**
 * A controller that serves all the 
 * right panel in the &lt;code&gt;index.html&lt;/code&gt; view.
 * @class RightNavCtrl
 */
angular.module(&#x27;MainApp&#x27;)
	.controller(&#x27;RightNavCtrl&#x27;, function($scope, $rootScope, $mdDialog){

		//used to monitor with 
		//oversized datasets
		/**
		* @property max_size
		* @type integer
		* @description A &lt;b&gt;global scope&lt;/b&gt; variable
		* that holds the maximal size of the 
		* timeseries accepted by DC.js in order
		* to explore the data interactively.
		*/
		$rootScope.max_size = 3000;

		/**
		* @property size_status
		* @type string
		* @description A &lt;b&gt;global scope&lt;/b&gt; variable
		* that holds the state of the timeseries size.
		* It is equal to &#x27;overflow&#x27; when the size is bigger
		* than &lt;code&gt;$rootScope.max_size&lt;/code&gt; or &#x27;normal&#x27;
		* otherwise.
		*/
		$rootScope.size_status = &#x27;normal&#x27;;

		/**
		* @property stats
		* @type json
		* @description A &lt;b&gt;local scope&lt;/b&gt; variable
		* that holds three timeseries statistics:
		* - &lt;i&gt;homogen&lt;/i&gt;: wheater or not 
		* one or multiple timeseries where 
		* homogeneous before the merge
		* - &lt;i&gt;size&lt;/i&gt;: a size of the final fused timeseries
		* - &lt;i&gt;per_day&lt;/i&gt;: an average number of datapoints
		* per day in the timeseries 
		*/
		$scope.stats = {};
		$scope.stats.homogen = &#x27;?&#x27;;
		$scope.stats.size = &#x27;?&#x27;;
		$scope.stats.per_day = &#x27;?&#x27;;

		/**
		* @property options
		* @type json
		* @description A &lt;b&gt;local scope&lt;/b&gt; variable
		* that holds some &lt;code&gt;tsproc&lt;/code&gt; configurations.
		* &lt;br/&gt;Transformation configs:
		* - &lt;i&gt;transform_type&lt;/i&gt;: the type
		* of transformation to apply in order
		* to synchronise multiple timeseries.
		* Possible values are &#x27;interp&#x27; (interpolation)
		* and &#x27;inters&#x27; (intersection)
		* - &lt;i&gt;interp_type&lt;/i&gt;: interpolation method.
		* Possible values are: &#x27;linear&#x27;, &#x27;cubic&#x27;, &lt;a href=&quot;https://en.wikipedia.org/wiki/Lanczos_resampling&quot;&gt;
		* &#x27;lanczos&#x27;&lt;/a&gt;, &#x27;nearest&#x27; (nearest neighbor)
		*
		* Reduction configs:
		* - &lt;i&gt;reduc_type&lt;/i&gt;: the reduction method to combine &lt;code&gt;$scope.options.reduc_size&lt;/code&gt;
		* datapoints into one. Possible values are: &#x27;skip&#x27;, &#x27;sum&#x27;, &#x27;avg&#x27;, &#x27;max&#x27;, &#x27;min&#x27;
		* - &lt;i&gt;reduc_size&lt;/i&gt;: the number of datapoints to be reduced into one 
		* the &lt;code&gt;$scope.options.reduc_type&lt;/code&gt; method
		* - &lt;i&gt;target_field&lt;/i&gt;: a target field used for &#x27;max&#x27; and &#x27;min&#x27; methods
		* 
		* Date configs:
		* - &lt;i&gt;from_date&lt;/i&gt;: a date from which to cut the dates
		* - &lt;i&gt;to_date&lt;/i&gt;: a date till withc to cut the dates
		*
		* Correlation configs:
		* - &lt;i&gt;count_negative&lt;/i&gt;: wheather or not to count 
		* the negative correlation as a correaltion
		* - &lt;i&gt;max_coef&lt;/i&gt;: wheather or not to use the
		* maximum correlation value as a criteria to consider
		* the set of datapoints as correlated. If &lt;code&gt;max_coef&lt;/code&gt;
		* is false, use max number of datapoints as a criteria
		*
		* Quantification config:
		* - &lt;i&gt;tsfield_quantum&lt;/i&gt;: the quantum of the 
		* timestamp attribute. Possible values are: 
		* &#x27;none&#x27;, &#x27;day&#x27;, &#x27;month&#x27;, &#x27;year&#x27;
		*/
		$scope.options = {};
		$scope.options.transform_type = &#x27;interp&#x27;;
		$scope.options.interp_type = &#x27;linear&#x27;;
		$scope.options.reduc_type = &#x27;skip&#x27;;
		$scope.options.reduc_size = 1;
		$scope.options.target_field = &#x27;&#x27;;
		$scope.options.from_date = null;
		$scope.options.to_date = null;
		$scope.options.count_negative = false;
		$scope.options.max_coef = true;
		$scope.options.tsfield_quantum = &#x27;none&#x27;;

		/**
		* @property enableDates
		* @type boolean
		* @description A &lt;b&gt;local scope&lt;/b&gt; variable
		* that serves the right panel 
		* in the &lt;code&gt;index.html&lt;/code&gt; view and
		* is used to enable/disable the dates
		* section.
		*/
		$scope.enableDates = false;

		/**
		* A &lt;b&gt;root scope&lt;/b&gt; method, that
		* collects all the choosen options
		* from the right panel in 
		* the &lt;code&gt;index.html&lt;/code&gt;, and returns them 
		* compacted into one json
		* @method getOptions
		* @return {json} All the options from the right panel
		*/
		$rootScope.getOptions = function(){

			//config json
			var config = {};

			//transformation type
			config.transform = {};
			config.transform.type = $scope.options.transform_type;
			if ($scope.options.transform_type === &#x27;interp&#x27;)
				config.transform.interp_type = $scope.options.interp_type;

			//reduction type
			config.reduction = {};
			config.reduction.type = $scope.options.reduc_type;
			config.reduction.size = $scope.options.reduc_size;
			config.reduction.target_field = $scope.options.target_field;

			//date borders
			config.date_borders = {};
			config.date_borders.from = {};
			config.date_borders.to = {};
			if ($scope.enableDates &amp;&amp; $scope.options.from_date &amp;&amp; $scope.options.to_date){

				config.date_borders.from.date = new Date($scope.options.from_date).toString();
				config.date_borders.to.date = new Date($scope.options.to_date).toString();
			}
			else{

				config.date_borders.from.date = &#x27;&#x27;;
				config.date_borders.to.date = &#x27;&#x27;;
			}

			//correlation detection options
			if ($scope.toogled_correlation){

				config.correlation = {};
				config.correlation.count_negative = $scope.options.count_negative;
				config.correlation.max_coef = $scope.options.max_coef;
			}
			else{
				config.correlation = null;
			}

			//quantification options
			config.tsfield_quantum = $scope.options.tsfield_quantum;

			return config;

		}

		/**
		* A &lt;b&gt;root scope&lt;/b&gt; method, that
		* is binded to all the options in the right panel 
		* of &lt;code&gt;index.html&lt;/code&gt; view and
		* sets them from the &lt;code&gt;config&lt;/code&gt;
		* json.
		* @method setStats
		* @param {json} config A json with options to set
		*/
		$rootScope.setStats = function(config){

			if (!config){

				$rootScope.size_status = &#x27;normal&#x27;;

				$scope.stats = {};
				$scope.stats.homogen = &#x27;?&#x27;
				$scope.stats.size = &#x27;?&#x27;;
				$scope.stats.per_day = &#x27;?&#x27;;

				$scope.options = {};
				$scope.options.transform_type = &#x27;interp&#x27;;
				$scope.options.interp_type = &#x27;linear&#x27;;
				$scope.options.reduc_type = &#x27;skip&#x27;;
				$scope.options.reduc_size = 1;
				$scope.options.target_field = &#x27;&#x27;;
				$scope.options.from_date = null;
				$scope.options.to_date = null;
				$scope.options.count_negative = false;
				$scope.options.max_coef = true;
				$scope.options.tsfield_quantum = &#x27;none&#x27;;

				return;
			}

			//size
			$scope.stats.size = (config.size) ? config.size : &#x27;?&#x27;;
			$rootScope.size_status = ($scope.stats.size &gt; $rootScope.max_size) ? &#x27;overflow&#x27; : &#x27;normal&#x27;;

			//instances per day
			$scope.stats.per_day = (config.per_day) ? config.per_day.toFixed(5) : &#x27;?&#x27;;

			//homogenity
			if (config.homogen)
				$scope.stats.homogen = &#x27;yes&#x27;;
			else
				$scope.stats.homogen = &#x27;no&#x27;;

			//setting the dates
			$scope.options.from_date = new Date(config.from);
			$scope.options.to_date = new Date(config.to);

		}

		/**
		* A &lt;b&gt;local scope&lt;/b&gt; method, that
		* serves the righ panel of &lt;code&gt;index.html&lt;/code&gt;
		* view and fires when the dragged field is dropped
		* on the input in the &#x27;Reduction&#x27; section.
		* When it is done, the input would have the name 
		* of the field on it.
		* @method onDroppedField
		* @param {json} data A dropped field
		*/
		$scope.onDroppedField = function(data){

			//if it is not a timestamp field
			if (!data.format &amp;&amp; data.field){

				//real target field
				$scope.options.target_field = data.field.name;
			}
		}


		/**
		* A &lt;b&gt;local scope&lt;/b&gt; method, attached to 
		* right panel of the &lt;code&gt;index.html&lt;/code&gt;
		* that shows a dialog (templated by &lt;code&gt;Alert.html&lt;/code&gt;)
		* with alert message about the size of a timeseries.
		* @method showAlert
		* @param ev Event
		*/
		$scope.showAlert = function(ev){

			$mdDialog.show({

				templateUrl: &#x27;../../templates/Alert.html&#x27;,
				parent: angular.element(document.body),
				targetEvent: ev,
				clickOutsideToClose: true,
			});
		};

		/*left here because it could be useful*/
		//done like this because of the
		//event propagation
		//used with &#x27;ng-click=&quot;toogleDates($event)&quot;&#x27;
		/*$scope.toogleDates = function(event){

			$scope.enableDates = !$scope.enableDates;

			//http://stackoverflow.com/questions/20300866/angularjs-ng-click-stoppropagation
			event.stopPropagation();
		}*/

		/**
		* A &lt;b&gt;local scope&lt;/b&gt; $watch method, attached
		* to the right panel in the &lt;code&gt;index.html&lt;/code&gt; that
		* fires when the &#x27;Correlation&#x27; section is toogled.
		* It then forces the values of the 
		* &lt;code&gt;$scope.options.count_negative&lt;/code&gt; 
		* and &lt;code&gt;$scope.options.max_coef&lt;/code&gt;.
		*/
		$scope.$watch(&#x27;toogled_correlation&#x27;, function(){

			if (!$scope.toogled_correlation){

				$scope.options.count_negative = false;
				$scope.options.max_coef = true;
			}
		});

		/**
		* A &lt;b&gt;root scope&lt;/b&gt; $watch method, attached 
		* to the right panel in the &lt;code&gt;index.html&lt;/code&gt;
		* that disables the correlation detection when 
		* the usage of Canvas.js is forced.t
		*/
		$rootScope.$watch(&#x27;force_canvasjs&#x27;, function(){

			if ($rootScope.force_canvasjs){

				$scope.toogled_correlation = false;
			}
		});

		/**
		* @property hide_dataset
		* @type boolean
		* @description A &lt;b&gt;local scope&lt;/b&gt; variable
		* that serves the right panel 
		* in the &lt;code&gt;index.html&lt;/code&gt; view and
		* is used to indicate the state of the
		* section &#x27;Dataset&#x27; (wheather it is 
		* activated or not).
		*/
		$scope.hide_dataset = false;

		/**
		* A &lt;b&gt;local scope&lt;/b&gt; method that
		* serves the righ panel of &lt;code&gt;index.html&lt;/code&gt;
		* view and attached to the switch in the 
		* &#x27;Dataset&#x27; section.
		* It is used to show/hide the dataset (
		* in a form of a table).
		*/		
		$scope.toggleDataset = function(){

			$scope.hide_dataset = !$scope.hide_dataset;

			$scope.hide_trans = $scope.hide_dataset;
			$scope.hide_redu = $scope.hide_dataset;
			$scope.hide_dates = $scope.hide_dataset;
			$scope.hide_quant = $scope.hide_dataset;
		};

	})
</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/js/tabs.js"></script>
</body>
</html>
