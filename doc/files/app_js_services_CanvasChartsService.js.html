<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app/js/services/CanvasChartsService.js - dataexp</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="../assets/css/logo.png" width="117" height="52">dataexp: app/js/services/CanvasChartsService.js</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div class="yui3-g">

        <div id="sidebar" class="yui3-u">
            <div id="modules" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Modules</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../modules/client.html">client</a>
                                <ul>
                                        <li><a href="../modules/client.html#Controllers">Controllers</a></li>
                                        <li><a href="../modules/client.html#Services">Services</a></li>
                                </ul>
                            </li>
                            <li><a href="../modules/server.html">server</a>
                                <ul>
                                        <li><a href="../modules/server.html#Connectors">Connectors</a></li>
                                        <li><a href="../modules/server.html#RestApi">RestApi</a></li>
                                </ul>
                            </li>
                    </ul>
                </div>
            </div>
            
            <div id="classes" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Classes</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../classes/CanvasChartsService.html">CanvasChartsService</a></li>
                            <li><a href="../classes/ChartsCtrl.html">ChartsCtrl</a></li>
                            <li><a href="../classes/DCChartsService.html">DCChartsService</a></li>
                            <li><a href="../classes/DeleteSource.html">DeleteSource</a></li>
                            <li><a href="../classes/DeleteZoneCtrl.html">DeleteZoneCtrl</a></li>
                            <li><a href="../classes/DialogCtrl.html">DialogCtrl</a></li>
                            <li><a href="../classes/FabCtrl.html">FabCtrl</a></li>
                            <li><a href="../classes/FieldsService.html">FieldsService</a></li>
                            <li><a href="../classes/FileConnector.html">FileConnector</a></li>
                            <li><a href="../classes/GetFields.html">GetFields</a></li>
                            <li><a href="../classes/GetSources.html">GetSources</a></li>
                            <li><a href="../classes/GetStores.html">GetStores</a></li>
                            <li><a href="../classes/GetTimseries.html">GetTimseries</a></li>
                            <li><a href="../classes/HideBtnCtrl.html">HideBtnCtrl</a></li>
                            <li><a href="../classes/LeftNavCtrl.html">LeftNavCtrl</a></li>
                            <li><a href="../classes/LoaderCtrl.html">LoaderCtrl</a></li>
                            <li><a href="../classes/main.html">main</a></li>
                            <li><a href="../classes/MongoConnector.html">MongoConnector</a></li>
                            <li><a href="../classes/MovableChartsCtrl.html">MovableChartsCtrl</a></li>
                            <li><a href="../classes/MysqlConnector.html">MysqlConnector</a></li>
                            <li><a href="../classes/PutSource.html">PutSource</a></li>
                            <li><a href="../classes/RightNavCtrl.html">RightNavCtrl</a></li>
                            <li><a href="../classes/routes.html">routes</a></li>
                            <li><a href="../classes/server.html">server</a></li>
                            <li><a href="../classes/SourcesService.html">SourcesService</a></li>
                            <li><a href="../classes/StoresService.html">StoresService</a></li>
                            <li><a href="../classes/TimeseriesService.html">TimeseriesService</a></li>
                            <li><a href="../classes/ToolBarCtrl.html">ToolBarCtrl</a></li>
                    </ul>
                </div>
            </div>
            
            
            
            
            
            <div id="fileTree" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Files</h2>
                </div>
                <div class="bd">
                    <ul><li>app/<ul><li>js/<ul><li><a href="../files/app_js_canvasjs.js.html">canvasjs.js</a></li><li>controllers/<ul><li><a href="../files/app_js_controllers_ChartsCtrl.js.html">ChartsCtrl.js</a></li><li><a href="../files/app_js_controllers_DeleteZoneCtrl.js.html">DeleteZoneCtrl.js</a></li><li><a href="../files/app_js_controllers_DialogCtrl.js.html">DialogCtrl.js</a></li><li><a href="../files/app_js_controllers_FabCtrl.js.html">FabCtrl.js</a></li><li><a href="../files/app_js_controllers_HideBtnCtrl.js.html">HideBtnCtrl.js</a></li><li><a href="../files/app_js_controllers_LeftNavCtrl.js.html">LeftNavCtrl.js</a></li><li><a href="../files/app_js_controllers_LoaderCtrl.js.html">LoaderCtrl.js</a></li><li><a href="../files/app_js_controllers_MovableChartsCtrl.js.html">MovableChartsCtrl.js</a></li><li><a href="../files/app_js_controllers_RightNavCtrl.js.html">RightNavCtrl.js</a></li><li><a href="../files/app_js_controllers_ToolBarCtrl.js.html">ToolBarCtrl.js</a></li></ul></li><li><a href="../files/app_js_main.js.html">main.js</a></li><li>services/<ul><li><a href="../files/app_js_services_CanvasChartsService.js.html">CanvasChartsService.js</a></li><li><a href="../files/app_js_services_DCChartsService.js.html">DCChartsService.js</a></li><li><a href="../files/app_js_services_FieldsService.js.html">FieldsService.js</a></li><li><a href="../files/app_js_services_SourcesService.js.html">SourcesService.js</a></li><li><a href="../files/app_js_services_StoresService.js.html">StoresService.js</a></li><li><a href="../files/app_js_services_TimeseriesService.js.html">TimeseriesService.js</a></li></ul></li></ul></li></ul></li><li>server.js/<ul></ul></li><li>server/<ul><li>connectors/<ul><li><a href="../files/server_connectors_FileConnector.js.html">FileConnector.js</a></li><li><a href="../files/server_connectors_MongoConnector.js.html">MongoConnector.js</a></li><li><a href="../files/server_connectors_MysqlConnector.js.html">MysqlConnector.js</a></li></ul></li><li>rest/<ul><li><a href="../files/server_rest_DeleteSource.js.html">DeleteSource.js</a></li><li><a href="../files/server_rest_GetFields.js.html">GetFields.js</a></li><li><a href="../files/server_rest_GetSources.js.html">GetSources.js</a></li><li><a href="../files/server_rest_GetStores.js.html">GetStores.js</a></li><li><a href="../files/server_rest_GetTimeseries.js.html">GetTimeseries.js</a></li><li><a href="../files/server_rest_PutSource.js.html">PutSource.js</a></li></ul></li><li><a href="../files/server_routes.js.html">routes.js</a></li></ul></li></ul>
                </div>
            </div>
            
        </div>

        <div id="main" class="yui3-u">
            <div class="content"><h4>app/js/services/CanvasChartsService.js</h4>

<pre class="code prettyprint linenums">
/**
 * Angualr.js services.
 * @module client
 * @submodule Services
 */

/**
 * A service that wraps 
 * a Canvas.js charting library and 
 * offers two public methods:
 * - &lt;b&gt;load()&lt;/b&gt;: loads the data (json array)
 * that should be visualysed
 * - &lt;b&gt;getChart()&lt;/b&gt;: returns the chart
 * filled with the data from the &lt;b&gt;load()&lt;/b&gt; function.
 * The chart can be then traced by calling &lt;i&gt;render()&lt;/i&gt;
 * function on it.
 * @class CanvasChartsService
 */
angular.module(&#x27;MainApp&#x27;)
	.service(&#x27;CanvasChartsService&#x27;, function(){
		
		/**
		* @property dataset
		* @type array
		* @description A local variable
		* that holds the loaded dataset.
		*/
		var dataset;

		/**
		* A private method that 
		* counts the number of occurences
		* of a specific field(key) in the array.
		* Creted because Canvas.js is not doing this
		* operation by default like DC.js.
		* @method count_obj_occurs
		* @param {array} array A json array where the occurences should be counted
		* @param {string} key A key which values should be counted
		* @return {array} A two-dimensional array with each value, and their respective count (cf example)
		* @example
		*     var array = [{a:1}, {a:1}, {a:2}, {a:3}, {a:3}];
		*     console.log(count_obj_occurs.call(this, array, &#x27;a&#x27;)); //[ [1,2,3], [2,1,2] ]
		*/
		var count_obj_occurs = function(array, key){

			var counted = [];
			var count = [];

			var i=0, j=0, k=0, l;
			var m,n = array.length;
			var index;

			while (k &lt; n){

				//find if already conuted
				var m = counted.length;
				index = -1;
				for (l=0; l&lt;m; l++){

					if (array[k][key] === counted[l]){

						index = l;
						break;
					}
				}

				//if not yet counted
				if (index &lt; 0){

					//mark as counted
					counted.push(array[k][key]);

					//count
					count.push(0);
					for (j=0; j&lt;n; j++){

						if (counted[i] === array[j][key]){

							count[i]++;
						}
					}

					i++;
				}
				else{
					k++;
				}
			}

			return [counted, count];
		}

		/**
		* A private method that returns a 
		* Cavnas.js pie chart. 
		* Only works with one field.
		* @method pie_chart
		* @param {array} container An id of a html tag container of the chart
		* @param {string} key1 A first key that should be visualised
		* @return {chart} A chart that can be rendered by calling the &lt;i&gt;render()&lt;/i&gt; method
		*/
		var pie_chart = function(container, key1){

			var canvas_dataset = [];
			var tmp;

			//count the occurences
			var counts = count_obj_occurs.call(this, dataset, key1);

			//generate dataset
			var n = counts[0].length;
			for (var i=0; i&lt;n; i++){

				tmp = {};
				
				tmp.label = &#x27;&#x27; + counts[0][i];
				tmp.y = parseFloat(counts[1][i]);

				canvas_dataset.push(tmp);
			};

			//data array
			var data = [];
			data.push({

				type:&#x27;pie&#x27;,
				radius: &#x27;100%&#x27;,
				startAngle: 270,
				indexLabelFontFamily: &quot;Garamond&quot;,       
				indexLabelFontSize: 15,
				indexLabelFontWeight: &quot;bold&quot;,
				startAngle:0,
				indexLabelFontColor: &quot;MistyRose&quot;,       
				indexLabelLineColor: &quot;darkgrey&quot;,
				indexLabelPlacement: &#x27;inside&#x27;,
				dataPoints: canvas_dataset
			});

			//chart config
			var config = {

				theme:&#x27;theme4&#x27;,
				backgroundColor: &#x27;#FAFAFA&#x27;,
				width: 335,
				height: 323,
				data: data
			};

			//generate chart
			var chart = new CanvasJS.Chart(container, config);

			return chart;
		}

		/**
		* A private method that returns a 
		* Cavnas.js timeline.
		* Can work with two fields.
		* @method timeline
		* @param {array} container An id of a html tag container of the chart
		* @param {string} key1 A first key that should be visualised
		* @param {string} key2 A second key that should be visualised 
		* @param {string} ts_key A timestamp key
		* @return {chart} A chart that can be rendered by calling the &lt;i&gt;render()&lt;/i&gt; method
		*/
		var timeline = function(container, key1, key2, ts_key){
			
			var canvas_dataset = [];
			var canvas_dataset2 = [];
			var tmp;

			//generate primary dataset
			dataset.forEach(function(doc, index){

				tmp = {};
				
				tmp.x = new Date(doc[ts_key]);
				tmp.y = parseFloat(doc[key1]);

				canvas_dataset.push(tmp);
			});

			//generate secondary dataset
			if (key2){

				dataset.forEach(function(doc, index){

					tmp = {};

					tmp.x = new Date(doc[ts_key]);
					tmp.y = parseFloat(doc[key2]);

					canvas_dataset2.push(tmp);
				});
			}

			//generate data array
			var data = [];
			data.push({

				type: &#x27;line&#x27;,
				lineThickness: 1.5,
				lineColor: &#x27;red&#x27;,
				dataPoints: canvas_dataset
			});

			if (canvas_dataset2.length){

				data.push({

					type: &#x27;line&#x27;,
					axisYType: &#x27;secondary&#x27;,
					lineThickness: 1.5,
					lineColor: &#x27;blue&#x27;,
					dataPoints: canvas_dataset2
				});
			}

			//chart config
			var config = {

				zoomEnabled: true,
				theme: &#x27;theme4&#x27;,
				axisY:{
					title: key1,
					gridColor: &#x27;gray&#x27;,
					gridThickness: 0.1
				},
				axisX:{
					gridColor: &#x27;gray&#x27;,
					gridThickness: 0.1
				},
				backgroundColor: &#x27;#FAFAFA&#x27;,
				width: 800,
				height: 323,
				data: data
			};
			if (canvas_dataset2.length){

				config.axisY2 = {title: key2};
			}

			//generate chart
			var composite_chart = new CanvasJS.Chart(container, config);

			return composite_chart;
		}

		/**
		* A private method that returns a 
		* Cavnas.js row chart.
		* Only works with one field.
		* @method row_chart
		* @param {array} container An id of a html tag container of the chart
		* @param {string} key1 A first key that should be visualised
		* @return {chart} A chart that can be rendered by calling the &lt;i&gt;render()&lt;/i&gt; method
		*/
		var row_chart = function(container, key1){

			var canvas_dataset = [];
			var tmp;

			//count the occurences
			var counts = count_obj_occurs.call(this, dataset, key1);

			//generate dataset
			var n = counts[0].length;
			for (var i=0; i&lt;n; i++){

				tmp = {};
				
				tmp.label = counts[0][i];
				tmp.y = parseFloat(counts[1][i]);

				canvas_dataset.push(tmp);
			};

			//data array
			var data = [];
			data.push({

				type:&#x27;bar&#x27;,
				dataPoints: canvas_dataset
			});

			//chart config
			var config = {

				theme:&#x27;theme4&#x27;,
				backgroundColor: &#x27;#FAFAFA&#x27;,
				axisX: {
					title: key1
				},
				axisY: {
					title: &#x27;#&#x27;,
					gridColor: &#x27;gray&#x27;,
					gridThickness: 0.1
				},
				width: 590,
				height: 319,
				data: data
			};

			//generate chart
			var chart = new CanvasJS.Chart(container, config);

			return chart;
		}

		/**
		* A private method that returns a 
		* Cavnas.js bar chart.
		* Only works with one field.
		* @method bar_chart
		* @param {array} container An id of a html tag container of the chart
		* @param {string} key1 A first key that should be visualised
		* @return {chart} A chart that can be rendered by calling the &lt;i&gt;render()&lt;/i&gt; method
		*/
		var bar_chart = function(container, key1){
	
			var canvas_dataset = [];
			var tmp;

			//count the occurences
			var counts = count_obj_occurs.call(this, dataset, key1);

			//generate dataset
			var n = counts[0].length;
			for (var i=0; i&lt;n; i++){

				tmp = {};
				
				tmp.label = counts[0][i];
				tmp.y = parseFloat(counts[1][i]);

				canvas_dataset.push(tmp);
			};

			//data array
			var data = [];
			data.push({

				type:&#x27;column&#x27;,
				dataPoints: canvas_dataset
			});

			//chart config
			var config = {

				theme:&#x27;theme4&#x27;,
				backgroundColor: &#x27;#FAFAFA&#x27;,
				axisX: {
					title: key1,
				},
				axisY: {
					title: &#x27;#&#x27;,
					gridColor: &#x27;gray&#x27;,
					gridThickness: 0.1
				},
				width: 590,
				height: 319,
				data: data
			};

			//generate chart
			var chart = new CanvasJS.Chart(container, config);

			return chart;
		}

		/**
		* A private method that returns a 
		* Cavnas.js scatter plot.
		* Only works with two fields.
		* @method scatter
		* @param {array} container An id of a html tag container of the chart
		* @param {string} key1 A x axis
		* @param {string} key2 A y axis
		* @return {chart} A chart that can be rendered by calling the &lt;i&gt;render()&lt;/i&gt; method
		*/
		var scatter = function(container, key1, key2){

			var canvas_dataset = [];
			var tmp;

			//generate dataset
			dataset.forEach(function(doc, index){

				tmp = {};
				
				tmp.x = parseFloat(doc[key1]);
				tmp.y = parseFloat(doc[key2]);

				canvas_dataset.push(tmp);
			});

			//data array
			var data = [];
			data.push({

				type: &#x27;scatter&#x27;,
				dataPoints: canvas_dataset
			});

			//chart config
			var config = {

				theme:&#x27;theme4&#x27;,
				zoomEnabled: true,
				backgroundColor: &#x27;#FAFAFA&#x27;,
				axisY:{
					title: key1,
					gridColor: &#x27;gray&#x27;,
					gridThickness: 0.1
				},
				axisX:{
					title: key2,
					gridColor: &#x27;gray&#x27;,
					gridThickness: 0.1
				},
				width: 580,
				height: 319,
				data: data
			};

			//generate chart
			var chart = new CanvasJS.Chart(container, config);

			return chart;
		}

		/**
		* @property ChartsEnum
		* @type json
		* @description A local variable
		* that holds all the chart names
		* and their related methods.
		*/
		var ChartsEnum = {

			&#x27;Pie&#x27;: pie_chart,
			&#x27;Timeline&#x27;: timeline,
			&#x27;Scatter&#x27;: scatter,
			&#x27;Row&#x27;: row_chart,
			&#x27;Bar&#x27;: bar_chart
		};

		/**
		* A public method that loads the data
		* to visualise into the local
		* variable &lt;code&gt;dataset&lt;/code&gt;.
		* Also checks the presence of the 
		* Canvas.js library.
		* @method load
		* @param {array} data Data that should be visualised
		* @param {callback} err_callback An error callback
		*/
		this.load = function(data, err_callback){

			//check if all the libraries
			//are imported
			if (typeof CanvasJS === &#x27;undefined&#x27;){

				err_callback(new Error(&#x27;Canvas.js is missing&#x27;));
				return;
			}

			//all good
			dataset = data;
			err_callback(null);
		}

		/**
		* A public method that returns a 
		* Cavnas.js chart specified by &lt;code&gt;chart_type&lt;/code&gt;
		* @method getChart
		* @param {string} chart_type A type of chart from the &lt;code&gt;ChartsEnum&lt;/code&gt;
		* @param {array} container An id of a html tag container of the chart
		* @param {string} key1 A first key that should be visualised
		* @param {string} key2 A second key that should be visualised 
		* @param {string} ts_key A timestamp key
		* @return {chart} A chart that can be rendered by calling the &lt;i&gt;render()&lt;/i&gt; method
		*/
		this.getChart = function(chart_type, container, key1, key2, ts_key){

			return ChartsEnum[chart_type].call(this, container, key1, key2, ts_key);
		}
	});
</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/js/tabs.js"></script>
</body>
</html>
