<!DOCTYPE html>
<html>

	<head>
		<link rel="stylesheet" href="../bower_components/angular-material/angular-material.css">
  <style>

    *{
        -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box;
    }
    [ng-drag], [ng-drag-clone]{
        -moz-user-select: -moz-none;
        -khtml-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    .drag-object, [ng-drag-clone], [ng-drop] [ng-drag]{
        width: 70px;
        height: 30px;
        background: rgba(1, 87, 155, 0.8);/*#01579b;*/
        border:solid 2px rgb(1, 87, 100);
        color: rgba(250, 250, 250, 0.8);
        text-align: center;
        font-weight: bold;
        line-height:30px;
        font-size: 75%;
        border-radius: 10px;
        display: inline-block;
        margin:10px;
        cursor: move;
		position: relative;
        overflow: hidden;
    }

	[ng-drag-clone]{
        margin: 0;
    }
    [ng-drag].drag-over{
        border:solid 1px red;
    }
    [ng-drag].dragging{
		opacity: 0.5;
    }
    [ng-drop]{
        /*background: rgba(0,255,0, 0.5);*/
        text-align: center;
        width: 200px;
        height: 150px;
        /*padding:5px;*/
        /*display: block;*/
        /*margin:20px auto;*/
        position: relative;
    }
    [ng-drop].drag-enter{
        border:solid 3px white;
    }
    [ng-drop] .drop_info{
    	color:gray;
    	font-size:0.8em;
        display: block;
        position: absolute;
        top:50%;
        left:50%;
        width: 200px;
        height: 20px;
        margin-left: -100px;
        margin-top: -10px;
    }

    .subheader{
    	background-color: rgb(235, 235, 235);
    }

    .list_container{

    	border-style: solid;
    	border-width: 5px;
    	border-color: rgb(235, 235, 235);
    	padding: 1px 10px 1px 10px;
    }

    .charts{
        width: auto;
        height: auto;

    }
    .chart{

    	background: rgba(0,255,0, 0.1);
    	border-radius: 20px;
    	cursor: move;
    }
    .delete_chart{
    	background: rgba(255,0,0, 0.2);
    	height: auto;
    }

    .platform{
		background: rgba(220, 220, 220, 0.8);
		border-radius: 20px;
    }

    span.title{

    	margin: 0 auto;
    	color: gray;
    	text-align: center;
    	font-size: 0.8em;
    }

    .loader{

    	background: rgba(240, 240, 240, 0.8);
    }
    #loader_normal{

    	background: rgba(0, 0, 255, 0.2);;
    	border-radius: 20px;
    	margin:5px;
        width: 200px;
        height: 100px;
    }

    #loader_timestamp{

    	background: rgba(0, 255, 0, 0.2);;
    	border-radius: 20px;
    	margin:5px;
        width: 200px;
        height: 50px;
    }

    [ng-drag].loaded{

    	background: rgb(1, 87, 155);
    	color: white;
    }

	.md-fab:hover, .md-fab.md-focused {
			background-color: grey !important; 
	}

	.list_item {

		background-color: rgba(240, 240, 240, 0.8);
		margin-bottom: 4px;
	}

/*    [ng-drop] div{
        position: relative;
        z-index: 2;
    }*/

  </style>
	</head>

	<body ng-app="MainApp" layout="column" ng-cloak>

		<!-- Toolbar -->
			<md-toolbar ng-controller="ToolbarCtrl" class="md-medium-tall md-primary md-whiteframe-4dp" layout="row">
				<md-button class="menu" aria-label="Menu button" ng-click="toggle()">
					<md-icon md-svg-src="images/menu.svg"></md-icon>
				</md-button>
				<h1>Title</h1>
			</md-toolbar>

		
		<div layout="row" flex>

			<!-- Left Side Bar -->
			<md-sidenav md-is-locked-open="$mdMedia('gt-sm')" class="md-sidenav-left md-whiteframe-z2" layout="column" md-component-id="left">

				<!-- Fab Button -->
				<md-button class="md-fab md-fab-bottom-right md-mini" aria-label="Add button" ng-click="showDialog($event)" ng-controller="FabCtrl">
					<md-icon md-svg-src="images/add.svg"></md-icon>
				</md-button>

				<!-- Sources, Stores, Fields List -->
				<div ng-controller="LeftNavCtrl" layout="column" flex layout-align="start">
					<md-subheader class="md-no-sticky md-primary subheader">Sources ({{sources_conf.length}})</md-subheader>
					<md-content flex="33" class="list_container"> <!-- md-content is scrollable -->
						<md-list>
							<md-list-item ng-repeat="source_config in sources_conf" class="list_item">
								<md-checkbox ng-model="source_config.wanted" aria-label="Source checkbox" ng-change="$root.loadStores(source_config)"></md-checkbox>
								<div layout="column">
									<span style="font-size: 1.2em;">{{source_config.name}}</span>
									<div layout="row">
										<span style="color:green; font-size: 0.7em;">{{getSourceType(source_config)}}</span>
										<span style="font-size: 0.7em;">-</span>
										<span style="color:blue; font-size: 0.7em;"> {{source_config.server}}</span>
									</div>
								</div>
								<md-icon class="md-secondary" ng-click="modifySource($event, source_config)" md-svg-src="images/settings.svg" aria-label="Settings"></md-icon>
								<md-divider></md-divider>
							</md-list-item>
						</md-list>
					</md-content>

					<md-divider></md-divider>
					<md-divider></md-divider>
					<md-subheader class="md-no-sticky md-warn subheader">Stores ({{stores_conf.length}})</md-subheader>
					<md-content flex="33" class="list_container">
						<!-- <md-divider></md-divider> -->
						<md-list>
							<md-list-item ng-repeat="store_config in stores_conf" class="list_item">
								<md-checkbox aria-label="Store checkbox" ng-model="store_config.wanted" ng-change="loadFields(store_config)"></md-checkbox>
								<div layout="column">
									<div layout="row">
										<span style="font-size: 1.2em;">{{store_config.store.short}}</span>
										<span style="font-size: 0.7em;"> ({{store_config.store.size}})</span>
									</div>

									<span style="color: green; font-size: 0.7em;">{{store_config.source.name}}</span>
								</div>
								<md-divider></md-divider>
							</md-list-item>
						</md-list>
					</md-content>

					<md-divider></md-divider>
					<md-divider></md-divider>
					<md-subheader class="md-no-sticky subheader">Fields ({{fields_conf.length}})</md-subheader>

					<md-content flex="33" class="list_container">
						<div layout-align="center">
							<span class="drag-object md-whiteframe-4dp" ng-repeat="field_config in fields_conf" ng-drag="true" ng-drag-data="field_config">
									{{field_config.short}}
								<md-tooltip md-visible="false" md-direction="top">
									{{field_config.field}} ({{field_config.store.name}})
								</md-tooltip>
							</span>
						</div>
					</md-content>
				</div>
			</md-sidenav>

			<!-- Main Container -->
			<md-content flex layout="column">

				<!-- Progress Bar -->
				<md-progress-linear md-mode="{{$root.activatePB}}" class="md-warn"></md-progress-linear>

				<!-- Charts Container -->
				<div class="charts" ng-controller="ChartsCtrl" ng-drop="true" ng-drop-success="onDropChart($data)" flex layout="row">
					
				</div>

				<!-- Footer -->
				<hr>
				<footer flex="none">
					<div class="md-whiteframe-4dp" layout="row" flex>

						<!-- Loader -->
						<div ng-controller="LoaderCtrl" class="loader" layout="column">

							<div id="loader_normal" ng-drop="true" ng-drop-success="onDropComplete($data)">
								<span class="drop_info">Fields</span>

								<div ng-repeat="field_config in $root.droppedFields" ng-drag="true" ng-drag-data="field_config" class="{{field_config.status}} md-whiteframe-4dp">
									{{field_config.short}}

									<md-tooltip md-visible="false" md-direction="top">
										{{field_config.field}} ({{field_config.store.name}})
									</md-tooltip>
								</div>
							</div>

							<div id="loader_timestamp" ng-drop="true" ng-drop-success="onTSDropComplete($data)">
								<span class="drop_info">Timestamp Fields</span>

								<div ng-repeat="field_config in $root.droppedTSFields" ng-drag="true" ng-drag-data="field_config" class="{{field_config.status}} md-whiteframe-4dp">
									{{field_config.short}}

									<md-tooltip md-visible="false" md-direction="top">
										{{field_config.field}} ({{field_config.store.name}})
									</md-tooltip>
								</div>
							</div>

							<div layout="row">
								<md-icon class="md-secondary" ng-click="load()" md-svg-src="images/download.svg" aria-label="Download"></md-icon>
								<!-- <md-progress-circular md-mode="indeterminate" class="md-accent"></md-progress-circular> -->
							</div>
						</div>

						<md-divider></md-divider>

						<!-- <div> -->
						<!-- md-content is problematic -->
						<md-content flex>
							<md-list layout="row" flex>

								<!-- Pie Chart -->
								<md-list-item layout="column">
									<div class="platform" ng-controller="PieChartCtrl" layout="column">
										<div class="chart md-whiteframe-4dp" ng-drop="true" ng-drop-success="onDropComplete($data)" ng-drag="true" ng-drag-data="{chart:'PieChart'}"> 

											<div ng-repeat="field_config in $root.chartFields" ng-drag="false" ng-drag-data="field_config" class="loaded">
												{{field_config.short}}
											</div>
										</div>

										<span class="title">Pie Chart</span>
									</div>
								</md-list-item>

								<!-- Graph -->
								<md-list-item layout="column">
									<div class="platform"  layout="column">
										<div class="chart md-whiteframe-4dp" ng-drop="true" ng-drop-success="onDropComplete($data)" ng-drag="true" ng-drag-data="{chart:'Graph'}"> 

	<!-- 										<div ng-repeat="field in $root.chartFields" ng-drag="false" ng-drag-data="field" class="loaded">
												{{field.name}}
											</div> -->
										</div>

										<span class="title">Graph</span>
									</div>
								</md-list-item>

								<!-- Scatter Plot -->
								<md-list-item layout="column">
									<div class="platform"  layout="column">
										<div class="chart md-whiteframe-4dp" ng-drop="true" ng-drop-success="onDropComplete($data)" ng-drag="true" ng-drag-data="{chart:'Graph'}"> 

	<!-- 										<div ng-repeat="field in $root.chartFields" ng-drag="false" ng-drag-data="field" class="loaded">
												{{field.name}}
											</div> -->
										</div>

										<span class="title">Scatter Plot</span>
									</div>
								</md-list-item>

								<!-- Row Chart -->
								<md-list-item layout="column">
									<div class="platform"  layout="column">
										<div class="chart md-whiteframe-4dp" ng-drop="true" ng-drop-success="onDropComplete($data)" ng-drag="true" ng-drag-data="{chart:'Graph'}"> 

	<!-- 										<div ng-repeat="field in $root.chartFields" ng-drag="false" ng-drag-data="field" class="loaded">
												{{field.name}}
											</div> -->
										</div>

										<span class="title">Row Chart</span>
									</div>
								</md-list-item>

								<!-- Bar Chart -->
								<md-list-item layout="column">
									<div class="platform"  layout="column">
										<div class="chart md-whiteframe-4dp" ng-drop="true" ng-drop-success="onDropComplete($data)" ng-drag="true" ng-drag-data="{chart:'Graph'}"> 

	<!-- 										<div ng-repeat="field in $root.chartFields" ng-drag="false" ng-drag-data="field" class="loaded">
												{{field.name}}
											</div> -->
										</div>

										<span class="title">Bar Chart</span>
									</div>
								</md-list-item>

							</md-list>

						</md-content>
						<!-- </div> -->

						<md-divider></md-divider>

						<!-- Delete zone -->
						<div class="delete_chart" ng-controller="RemoveChartCtrl" ng-drop="true" ng-drop-success="onDropRemove($data)" layout="column">
							<md-icon md-svg-src="../images/delete2.svg" aria-label="Delete source" class="drop_info" style="height: 60px;"></md-icon>
						</div>

						<div ng-drag-clone=""></div> 
					</div>
				</footer>

			</md-content>

			<!-- Right Side Bar -->
			<md-sidenav md-is-locked-open="$mdMedia('gt-sm')" class="md-sidenav-right md-whiteframe-z2" layout="column" md-component-id="right">
				<div layout="column" flex layout-align="start" ng-controller="RightNavCtrl">

					<!-- Stats -->
					<md-content layout="column"  class="list_container" style="padding:5px;">
						<div layout="row" style="margin:10px;">
							<span style="font-size:0.9em; color:rgb(90, 90, 90);">Homogeneous:&nbsp;</span>
							<i style="font-size:0.9em;">{{homogen}}</i>
						</div>
						<md-divider></md-divider>

						<div layout="row" style="margin:10px;">
							<span style="font-size:0.9em; color:rgb(90, 90, 90);">Size:&nbsp;</span>
							<i style="font-size:0.9em;">{{size}}</i>
						</div>
						<md-divider></md-divider>

						<div layout="row" style="margin:10px;">
							<span style="font-size:0.9em; color:rgb(90, 90, 90);">Per day (mean):&nbsp;</span>
							<i style="font-size:0.9em;">{{per_day}}</i>
						</div>
						
					</md-content>

					<!-- Transformations -->
					<md-divider></md-divider>
					<md-divider></md-divider>
					<md-subheader class="md-no-sticky md-primary subheader">Transformations</md-subheader>
					<md-content layout="column" class="list_container">
						<md-radio-group ng-model="transform_type" style="margin:5px;">
							<md-radio-button value="inters">Intersection</md-radio-button>
							
							<div layout="row" layout-align="start center" style="height: 30px;">
								<md-radio-button value="interp">Interpolation:</md-radio-button>

								<md-input-container style="margin:0px; margin-left:10px; margin-bottom: 20px;">
									<md-select ng-disabled="transform_type=='inters'" ng-model="interp_type" aria-label="Interpolation Type">
										<md-option value="linear"><span style="font-size:0.8em;">Linear</span></md-option>
										<md-option value="cubic"><span style="font-size:0.8em;">Cubic</span></md-option>
										<md-option value="lanczos"><span style="font-size:0.8em;">Lanczos</span></md-option>
										<md-option value="nearest"><span style="font-size:0.8em;">Nearest Neighbor</span></md-option>
									</md-select>
								</md-input-container>
							</div>
						</md-radio-group>
					</md-content>

					<md-divider></md-divider>
					<md-divider></md-divider>
					<md-subheader class="md-no-sticky md-primary subheader">Reduction</md-subheader>
					<md-content layout="column" class="list_container">
						<div layout="row">
							<md-input-container flex style="margin-bottom: 0px;">
								<label>Type</label>
								<md-select ng-model="reduc_type">
									<md-option value="skip">Skip</md-option>
									<md-option value="sum">Sum</md-option>
									<md-option value="avg">Average</md-option>
									<md-option value="max">Max</md-option>
									<md-option value="min">Min</md-option>
								</md-select>
							</md-input-container>

							<md-input-container flex style="margin-bottom: 0px;">
								<label>Size</label>
								<input type="number" ng-model="reduc_size" min="1" ng-pattern="/^\d*$/">
							</md-input-container>
						</div>
					</md-content>

					<md-divider></md-divider>
					<md-divider></md-divider>
					<div layout="row" class="subheader">
						<md-subheader class="md-no-sticky md-primary subheader" style="margin:8px 0;">Dates</md-subheader>
						<md-switch ng-model="enableDates" class="md-mini" aria-label="Switch"></md-switch>
					</div>

					<div layout="column" layout-align="start center" class="list_container">
						<md-datepicker style="margin-right: 0px;" ng-disabled="!enableDates" ng-model="from_date" md-placeholder="From"></md-datepicker>
						<md-datepicker style="margin-right: 0px;" ng-disabled="!enableDates" ng-model="to_date" md-placeholder="To"></md-datepicker>
					</div>

				</div>

			</md-sidenav>


		</div>

		<!-- bower:js -->
		<script src="../bower_components/angular/angular.js"></script>
		<script src="../bower_components/angular-animate/angular-animate.js"></script>
		<script src="../bower_components/angular-aria/angular-aria.js"></script>
		<script src="../bower_components/angular-messages/angular-messages.js"></script>
		<script src="../bower_components/angular-material/angular-material.js"></script>
		<script src="../bower_components/ngDraggable/ngDraggable.js"></script>
		<script src="../bower_components/angular-resource/angular-resource.js"></script>
		<!-- endbower -->

		<script src="js/main.js"></script>
		<script src="js/services/SourcesService.js"></script>
		<script src="js/services/StoresService.js"></script>
		<script src="js/services/FieldsService.js"></script>
		<script src="js/services/TimeseriesService.js"></script>
		<script src="js/controllers/ToolbarCtrl.js"></script>
		<script src="js/controllers/FabCtrl.js"></script>
		<script src="js/controllers/LeftNavCtrl.js"></script>
		<script src="js/controllers/RightNavCtrl.js"></script>
		<script src="js/controllers/DialogCtrl.js"></script>
		<script src="js/controllers/PieChartCtrl.js"></script>
		<script src="js/controllers/RemoveChartCtrl.js"></script>
		<script src="js/controllers/ChartsCtrl.js"></script>
		<script src="js/controllers/LoaderCtrl.js"></script>

	</body>

</html>

